Q:负载均衡原理
===
首先奉上经典详解：

https://blog.csdn.net/bjweimengshu/article/details/80103203

对于该详解做一简单概述：

1.相对于负载均衡，也可以直接提升服务器硬件性能，这种叫做垂直扩展（Scale Up）。
2.当多服务器时不能直接暴露服务器ip，让用户自行选择ip登录。需要对ip进行隐藏。

#### 方式1：DNS
```txt
张大胖眼前一亮， 突然有了主意：“有了！我们有个中间层啊，对，就是DNS，我们可以设置一下，让我们网站的域名映射到多个服务器的IP，用户面对的是我们系统的域名，然后我们可以采用一种轮询的方式， 用户1的机器做域名解析的时候，DNS返回IP1, 用户2的机器做域名解析的时候，DNS返回IP2...... 这样不就可以实现各个机器的负载相对均衡了吗？”
......
Bill 思考片刻，发现了漏洞：“这样做有个很要命的问题，由于DNS这个分层的系统中有缓存，用户端的机器也有缓存，如果某个机器出故障，域名解析仍然会返回那个出问题机器的IP，那所有访问该机器的用户都会出问题， 即使我们把这个机器的IP从DNS中删除也不行， 这就麻烦了。”
```
简单来说，就是由于DNS缓存导致宕机的时候用户无法自动切换到正常服务上。

#### 方式二：Load Balancer （简称LB）
```txt
客户端 --> Load Balancer --> RS --> Load Balancer --> 客户端
......
访问策略：
轮询： 这个最简单，就是一个挨一个轮换。
加权轮询： 为了应对某些服务器性能好，可以让他们的权重高一点，被选中的几率大一点。
最少连接： 哪个服务器处理的连接少，就发给谁。
加权最少连接：在最少连接的基础上，也加上权重
```
简单来说：主要是增加了一个LB，他提供对IP（网络层）的数据修改（目的ip和源ip）。由于同一个用户请求会分为多个包发送，如果这些数据包被我们的Load Balancer发到了不同的机器上，那就完全乱套了。Load Balancer必须得维护一个表，这个表需要记录下客户端的数据包被我们转发到了哪个真实的服务器上， 这样当下一个数据包到来时，我们就可以把它转发到同一个服务器上去。所以LB是面向连接，也就是OSI网络体系的第4层， 可以称为四层负载均衡。

#### 方式三：责任分离
```txt
客户端 --> Load Balancer --> RS --> 客户端
......
Load Balancer存在这瓶颈：所有的流量都要通过它，它要修改客户发来的数据包， 还要修改发给客户的数据包。
网络访问还有个极大的特点，那就是请求报文较短而响应报文往往包含大量的数据。这是很容易理解的，一个HTTP GET请求短得可怜，可是返回的HTML却是极长 -- 这就进一步加剧了Load Balancer修改数据包的工作。
......
对， 是使用ARP协议，把一个IP地址（115.39.19.22）给广播出去，然后具有此IP机器就会回复自己的MAC地址。 但是现在有好几台机器都有同一个IP（115.39.19.22）， 怎么办？
Bill 说道：“我们只让Load Balancer 响应这个VIP地址（115.39.19.22）的ARP请求，对于RS1,RS2,RS3, 抑制住对这个VIP地址的ARP响应，不就可以唯一地确定Load Balancer了？ ”
```
关键点：使用ARP协议。


Q:LVS负载均衡（LVS简介、三种工作模式、十种调度算法）
===
https://blog.csdn.net/bjweimengshu/article/details/80103203
